# 一、
#### 认证方式
- 除登录接口外，其他接口需在 HTTP 请求头中携带 JWT 令牌进行身份认证，格式为 `Authorization: Bearer [JWT Token]` 。
- 登录接口成功调用后，由后端生成 JWT 令牌并返回给前端，令牌设定有效期（如 2 小时 ），有效期内可用于认证访问需权限的接口 。
#### 请求方法

#### 状态码说明

|状态码|含义|说明|
|---|---|---|
|200|成功|操作成功|
|400|请求错误|参数校验失败|
|401|未授权|未登录或Token失效|
|403|禁止访问|权限不足|
|404|资源不存在|接口或数据不存在|
|500|服务器错误|服务器内部错误|
# 二、认证模块
## 2.1 用户登录
- **接口地址**：/auth/login
- **请求方式**：POST
- **请求参数**：

| 参数名       | 类型     | 必填  | 说明                                         |
| --------- | ------ | --- | ------------------------------------------ |
| user_type | String | 是   | 用户类型(user/teach_sec/class_mgr/super_admin) |
| account   | String | 是   | 登录账号                                       |
| password  | String | 是   | 密码                                         |

- **返回参数**：  

| 参数名     | 类型     | 说明      |
| ------- | ------ | ------- |
| token   | String | JWT认证令牌 |
| name    | String | 用户姓名    |
| college | String | 所属学院    |
- **示例**
```json
//请求
{
  "role": "user",
  "account": "202313143000318",
  "password": "123456"
}
//返回
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
	"account": "202313143000318",
    "name": "王美淇",
	 "role": "user_type",  
    "college": "人工智能学院"
  }
}
```
# 三、超级管理员模块
## 3.1用户列表
- **接口地址**：/admin/listUsers
- **请求方式**：GET
- **权限要求**：SUPER_ADMIN
- **请求参数**：

| 参数名     | 类型    | 必填 | 说明                                    |
| ---------- | ------- | ---- | --------------------------------------- |
| user_type  | String  | 否   | 用户角色(=all/user/teach_sec/class_mgr) |
| page       | Integer | 否   | 页码                                    |
| size       | Integer | 否   | 每页数量                                |
| college_id | String  | 否   | 学院编号                                |
| user_name  | String  | 否   | 用户姓名                                |
| user_id    | String  | 否   | 用户编号                                |

- **返回参数**： 

| 参数名          | 类型      | 说明         |
| ------------ | ------- | ---------- |
| total_users  | Integer | 总用户数       |
| active_users | Integer | 活跃用户       |
| name         | String  | 姓名（用户名列）   |
| user_type    | String  | 角色         |
| college      | String  | 所属学院       |
| user_account | String  | 学号 / 工号    |
| last_login   | String  | 最后登录时间     |
| total        | Integer | 总记录数       |
| page         | Integer | 页码(默认1)    |
| size         | Integer | 每页数量(默认10) |

- **示例**：
```json
//请求
http://localhost:8081//listAll?role=user
//返回
{
  "code": 200,
  "data": {
    "total_users": 156,
    "active_users": 114,
    "list": [
      {
        "name": "小小",
        "user_type": "teach_sec",
        "college": "人工智能学院",
        "id":"202313143000345",
		"last_login":"2025-05-29 10:15"
      }
    ]
  }
}
```
## 3.2编辑用户
- **接口地址**：/admin/updateUsers
- **请求方式**：POST
- **请求参数**：

| 参数名         | 类型     | 是否必填 | 说明                  |
| ----------- | ------ | ---- | ------------------- |
| account     | String | 是    | 账号，唯一标识用户           |
| name        | String | 是    | 姓名                  |
| password    | String | 否    | 密码，不修改时留空           |
| phone       | String | 是    | 手机号                 |
| college_id  | String | 条件必填 | 所属学院，普通用户、教学秘书角色时必填 |
| building_id | String | 否    | 所管楼栋，仅用于教室管理员       |
| user_type   | String | 是    | 角色，区分用户、教秘、教室管理员    |

- **返回参数**： 

| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |

- **示例**
## 3.3删除用户
- **接口地址**：/admin/deleteUsers
- **请求方式**：GET
- **请求参数**：

| 参数名     | 类型     | 是否必填 | 说明        |
| ------- | ------ | ---- | --------- |
| account | String | 是    | 账号，唯一标识用户 |
- **返回参数**： 


| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |

- **示例**
## 3.4添加用户
- **接口地址**：/admin/addUsers
- **请求方式**：POST
- **请求参数**：

| 参数名      | 类型   | 是否必填 | 说明                                   |
| ----------- | ------ | -------- | -------------------------------------- |
| account     | String | 是       | 账号，唯一标识用户                     |
| name        | String | 是       | 姓名                                   |
| password    | String | 否       | 密码，不修改时留空                     |
| phone       | String | 是       | 手机号                                 |
| college_id  | String | 条件必填 | 所属学院，普通用户、教学秘书角色时必填 |
| building_id | String | 否       | 教室管理员所管楼栋                     |
| role        | String | 是       | 角色，区分用户、教秘、教室管理员       |
- **返回参数**： 

| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |
- **示例**
## 3.5日志显示
- **接口地址**：/admin/listLogs
- **请求方式**：GET
- **请求参数**：

| 参数名       | 类型    | 是否必填 | 说明                                             |
| ------------ | ------- | -------- | ------------------------------------------------ |
| apply_status | String  | 否       | 申请状态（待审核 / 已通过 / 已驳回）             |
| college_id   | String  | 否       | 前端显示学院名称（下拉框）                       |
| building_id  | String  | 否       | 前端显示所申请楼栋名称（下拉框）                 |
| user_name    | String  | 否       | 申请人姓名（模糊搜索）                           |
| date_start   | String  | 否       | 教室资源表的日期，自定义开始日期（`yyyy-MM-dd`） |
| date_end     | String  | 否       | 教室资源表的日期，自定义结束日期（`yyyy-MM-dd`） |
| page         | Integer | 否       | 当前页码                                         |
| size         | Integer | 否       | 每页条数                                         |
| page         | Integer | 否       | 页码                                             |
| size         | Integer | 否       | 每页条数                                         |

- **返回参数**：

| 参数名        | 类型    | 说明                                          |
| ------------- | ------- | --------------------------------------------- |
| today_pending | Integer | 全校今日待审核数                              |
| week_approved | Integer | 全校本周通过数                                |
| week_rejected | Integer | 全校本周驳回数                                |
| user_name     | String  | 申请人姓名                                    |
| phone         | String  | 联系电话                                      |
| book_time     | String  | 预约时间                                      |
| classroom     | String  | 教室（格式：building_name+room_num)           |
| use_time      | String  | 使用时间（格式：date+week+day_of_week+period) |
| purpose       | String  | 用途                                          |
| person_count  | String  | 人数                                          |
| apply_status  | String  | 申请状态（待审核 / 已通过 / 已驳回）          |
| total         | Integer | 列表总记录数（总页数 = 总记录数 ÷ 每页条数）  |
| page          | Integer | 当前页码                                      |
| size          | Integer | 每页条数                                      |


- **示例**
## 3.6日志详情查看
- **接口地址**：/admin/viewLogs
- **请求方式**：GET
- **请求参数**：

| 参数名      | 类型     | 是否必填 | 说明            |
| -------- | ------ | ---- | ------------- |
| apply_id | String | 是    | 申请编号，申请记录唯一标识 |

- **返回参数**： 

| 参数名           | 类型     | 说明                                    |
| ------------- | ------ | ------------------------------------- |
| user_name     | String | 申请人姓名                                 |
| phone         | String | 联系电话                                  |
| book_time     | String | 预约时间                                  |
| classroom     | String | 教室（格式：building_name+room_num)         |
| use_time      | String | 使用时间（格式：date+week+day_of_week+period) |
| purpose       | String | 用途                                    |
| person_count  | String | 人数                                    |
| apply_status  | String | 申请状态（待审核 / 已通过 / 已驳回）                 |
| reject_reason | String | 驳回申请原因                                |

- **示例**
## 3.7数据统计与分析
- **接口地址**：/admin/analyzeData
- **请求方式**：GET
- **请求参数**：

| 参数名     | 类型   | 必填 | 说明                                             |
| ---------- | ------ | ---- | ------------------------------------------------ |
| date_start | String | 否   | 教室资源表的日期，自定义开始日期（`yyyy-MM-dd`） |
| date_end   | String | 否   | 教室资源表的日期，自定义结束日期（`yyyy-MM-dd`） |

- **返回参数**： 

| 参数名                | 类型         | 说明                                                         |
| --------------------- | ------------ | ------------------------------------------------------------ |
| total_users           | Integer      | 总用户数                                                     |
| total_sec             | Integer      | 总教秘数                                                     |
| total_mgr             | Integer      | 总教师管理员数                                               |
| active_users          | Integer      | 当月活跃用户                                                 |
| total_applies         | Integer      | 所选时间段内的预约数，(默认是当月预约数)                     |
| mom_appt_comparison   | Integer      | 当月与上个月预约总数相差多少<br />减少用负数，增加是正数     |
| active_classroom      | String(数组) | 哪些教室经常用(筛选五个出来)                                 |
| active_classroom_type | Sting(数组)  | 哪种类型教室经常用(筛选五个出来)                             |
| total_of_building     | String(对象) | 当月每一栋楼预约数.(对象里面有building_name(楼名),<br />total_applies(这栋楼的当月预约数)) |

- **示例**
# 四、教秘模块
## 4.1教秘审核工作台
_同上面超级管理员一样
- **接口地址**：/sec/listLogs
- **请求方式**：GET
- **请求参数**：

| 参数名       | 类型    | 是否必填 | 说明                                             |
| ------------ | ------- | -------- | ------------------------------------------------ |
| apply_status | String  | 否       | 申请状态（待审核 / 已通过 / 已驳回）             |
| building_id  | String  | 否       | 前端显示所申请楼栋名称（下拉框）                 |
| user_name    | String  | 否       | 申请人姓名（模糊搜索）                           |
| date_start   | String  | 否       | 教室资源表的日期，自定义开始日期（`yyyy-MM-dd`） |
| date_end     | String  | 否       | 教室资源表的日期，自定义结束日期（`yyyy-MM-dd`） |
| total        | Integer | 否       | 列表总记录数（总页数 = 总记录数 ÷ 每页条数）     |
| page         | Integer | 否       | 当前页码                                         |
| size         | Integer | 否       | 每页条数                                         |

- **返回参数**：

| 参数名           | 类型      | 说明                                    |
| ------------- | ------- | ------------------------------------- |
| today_pending | Integer | 全校今日待审核数                              |
| week_approved | Integer | 全校本周通过数                               |
| week_rejected | Integer | 全校本周驳回数                               |
| user_name     | String  | 申请人姓名                                 |
| phone         | String  | 联系电话                                  |
| book_time     | String  | 预约时间                                  |
| classroom     | String  | 教室（格式：building_name+room_num)         |
| use_time      | String  | 使用时间（格式：date+week+day_of_week+period) |
| purpose       | String  | 用途                                    |
| person_count  | String  | 人数                                    |
| apply_status  | String  | 申请状态（待审核 / 已通过 / 已驳回）                 |
| view_details  | String  | 操作，查看详情                               |
| total         | Integer | 列表总记录数（总页数 = 总记录数 ÷ 每页条数）             |
| page          | Integer | 当前页码                                  |
| size          | Integer | 每页条数                                  |

- **示例**
## 4.2审核详情查看
_接口同上面超级管理员一样
在接口查询时添加`where user_cancel = false`的条件，确保返回的是 “用户未取消” 的有效预约记录。自动过滤`user_cancel=true`的预约记录（用户取消的预约不显示）_

- **接口地址**：/sec/viewLogs
- **请求方式**：GET
- **请求参数**：

| 参数名      | 类型     | 是否必填 | 说明            |
| -------- | ------ | ---- | ------------- |
| apply_id | String | 是    | 申请编号，申请记录唯一标识 |

- **返回参数**： 

| 参数名           | 类型     | 说明                                    |
| ------------- | ------ | ------------------------------------- |
| user_name     | String | 申请人姓名                                 |
| phone         | String | 联系电话                                  |
| book_time     | String | 预约时间                                  |
| classroom     | String | 教室（格式：building_name+room_num)         |
| use_time      | String | 使用时间（格式：date+week+day_of_week+period) |
| purpose       | String | 用途                                    |
| person_count  | String | 人数                                    |
| apply_status  | String | 申请状态（待审核 / 已通过 / 已驳回）                 |
| reject_reason | String | 驳回申请原因                                |

- **示例**
## 4.3审核状态更新（可修改批注原因）
- **接口地址**：/sec/updateStatus
- **请求方式**：POST
- **请求参数**：

| 参数名           | 类型     | 是否必填 | 说明                           |
| ------------- | ------ | ---- | ---------------------------- |
| apply_id      | String | 是    | 申请记录唯一标识（从详情接口的`apply_id`获取） |
| apply_status  | String | 是    | 申请状态（待审核 / 已通过 / 已驳回）        |
| reject_reason | String | 否    | 驳回原因（仅当`status=已驳回`时必填）      |
- **返回参数**： 

| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |
- **示例**
## 4.4查看教室使用率页面
- **接口地址**：/sec/classroomUsage
- **请求方式**：GET
- **请求参数**：

| 参数名      | 类型    | 是否必填 | 说明                                             |
| ----------- | ------- | -------- | ------------------------------------------------ |
| date_start  | String  | 否       | 教室资源表的日期，自定义开始日期（`yyyy-MM-dd`） |
| date_end    | String  | 否       | 教室资源表的日期，自定义结束日期（`yyyy-MM-dd`） |
| building_id | String  | 否       | 前端显示所申请楼栋名称（下拉框）                 |
| room_type   | String  | 否       | 教室类型筛选（关联`classroom`表`room_type`）     |
| page        | Integer | 否       | 表格数据页码（默认 1）                           |
| size        | Integer | 否       | 表格数据每页条数（默认 10）                      |

- **返回参数**： 

| 参数名               | 类型      | 说明                                         |
| ----------------- | ------- | ------------------------------------------ |
| avg_usage_rate    | String  | 本时段平均使用率，基于`apply_info`（已通过）和`classroom`计算 |
| most_used         | String  | 使用最频繁的教室名称（`building_name+room_num`）       |
| most_usage_count  | Integer | 使用次数                                       |
| least_used        | String  | 使用最少的教室教室名称                                |
| least_usage_count | Integer | 使用次数                                       |
| total_usage       | Integer | 本时段所有教室总使用次数，统计`apply_info`中已通过的申请         |
| classroom         | String  | 教室名称（`building_name+room_num`）             |
| room_type         | String  | 教室类型                                       |
| usage_count       | Integer | 本时段单教室使用次数，统计`apply_info`中该教室的已通过申请        |
| usage_rate        | String  | 本时段使用率（`使用次数/总可用时段`）                       |
| change_rate       | String  | 较上周变化率                                     |
| total             | Integer | 符合条件的教室总数                                  |
| page              | Integer | 当前页码                                       |
| size              | Integer | 每页条数                                       |
- **示例**
# 五、教室管理员
## 5.1教室分页&筛选
- **接口地址**：/mgr/selectClassroom
- **请求方式**：GET
- **请求参数**：

| 参数名         | 类型      | 必填  | 说明                 |
| ----------- | ------- | --- | ------------------ |
| room_num    | String  | 否   | 楼层筛选，通过教室号的第一个数字   |
| capacity    | Integer | 否   | 最小容量筛选             |
| room_status | String  | 否   | 教室状态筛选(可用/已占用/维护中) |
| room_type   | String  | 否   | 教室类型筛选             |
| page        | Integer | 否   | 页码                 |
| size        | Integer | 否   | 每页条数               |

- **返回参数**： 

| 参数名                   | 类型      | 说明                                                     |
| --------------------- | ------- | ------------------------------------------------------ |
| today_available_count | Integer | 今日可用教室数（且今日有空闲时段的教室总数）基于`classroom_resource`表今日未占用时段计算 |
| room_num              | String  | 教室编号                                                   |
| capacity              | Integer | 教室容量                                                   |
| room_type             | String  | 教室类型                                                   |
| room_status           | String  | 教室状态（可用 / 维修中 / 已占用）                                   |
| total                 | Integer | 符合条件的教室总数                                              |
| page                  | Integer | 页码                                                     |
| size                  | Integer | 每页条数                                                   |
- **示例**

## 5.2批量更新教室状态
- **接口地址**：/mgr/batchUpdateStatus
- **请求方式**：POST
- **请求参数**：

| 参数名         | 类型     | 是否必填 | 说明                   |
| ----------- | ------ | ---- | -------------------- |
| room_num    | String(数组) | 是    | 需更新状态的教室编号列表         |
| room_status | String | 是    | 教室状态（空闲、不可用） |
| duration |DateTime|否|格式：（`yyyy-MM-dd` HH:MM:SS）<br />当更改为不可用时必填，其他状态不用填<br />用来表示这个教室不可用的状态延续到什么时候。<br />|

==传参示例==：

```json
[
	{
		"room_numm":"b001-101",
		"room_status":"空闲",
         "duration":""
	},
	{
		"room_numm":"b001-101",
		"room_status":"不可用"	,
         "duration":"2025-8-30 23:59:59"
	},
]
```



**返回参数**：

| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |
- **示例**



## 5.3教室审核情况
_在接口查询时添加`where user_cancel = false`的条件，确保返回的是 “用户未取消” 的有效预约记录。自动过滤自动过滤 user_cancel=false（用户取消）且 apply_status=已通过 的记录
- **接口地址**：/mgr/listApplyInfo
- **请求方式**：GET
- **请求参数**：

| 参数名       | 类型    | 是否必填 | 说明                                                      |
| ------------ | ------- | -------- | --------------------------------------------------------- |
| apply_status | String  | 否       | 审核状态筛选（已批准 / 已驳）                             |
| date_start   | String  | 否       | 教室资源表的日期，自定义开始日期（`yyyy-MM-dd` HH:MM:SS） |
| date_end     | String  | 否       | 教室资源表的日期，自定义结束日期（`yyyy-MM-dd `HH:MM:SS） |
| page         | Integer | 否       | 当前页码                                                  |
| size         | Integer | 否       | 每页条数                                                  |
- **返回参数**：

| 参数名           | 类型      | 说明                                       |
| ------------- | ------- | ---------------------------------------- |
| managed_rooms | Integer | 管辖教室总数（管理员负责楼栋下的教室数量）`building_id`关联的记录数 |
| apply_id      | String  | 申请编号                                     |
| sec_name      | String  | 审核者教秘姓名                                  |
| classroom     | String  | 教室（格式：`building_name+room_num`）          |
| date          | String  | 使用日期                                     |
| purpose       | String  | 用途                                       |
| total         | Integer | 符合条件的通知总数                                |
| page          | Integer | 当前页码                                     |
| size          | Integer | 每页条数                                     |
- **示例**
# 六、用户
## 6.1用户查询教室
- **接口地址**：/user/selectClassroom
- **请求方式**：GET
- **请求参数**：

| 参数名          | 类型    | 是否必填 | 说明                                   |
| --------------- | ------- | -------- | -------------------------------------- |
| building_id     | String  | 否       | 教学楼筛选（下拉框，关联`building`表） |
| capacity        | Integer | 否       | 最小容量筛选                           |
| room_type       | String  | 否       | 教室类型筛选                           |
| room_status     | String  | 否       | 教室状态筛选（可用 / 维修中 / 已占用） |
| res_week        | String  | 否       | 周次                                   |
| res_day_of_week | Sting   | 否       | 星期                                   |
| period          | String  | 否       | 使用节次                               |
| date            | String  | 是       | 使用日期（格式：`yyyy-MM-dd`）         |
| page            | Integer | 否       | 当前页码                               |
| size            | Integer | 否       | 每页条数                               |
- **返回参数**：

| 参数名          | 类型    | 说明                                |
| --------------- | ------- | ----------------------------------- |
| res_id          | String  | 教室资源编号                        |
| classroom       | String  | 教室（格式：`building_n+room_num`） |
| capacity        | Integer | 容量                                |
| room_type       | String  | 教室类型                            |
| res_week        | String  | 周次                                |
| res_day_of_week | String  | 星期                                |
| period          | String  | 节次                                |
| room_status     | String  | 教室状态                            |
| date            | date    | 日期                                |
| total           | Integer | 符合条件的教室总数                  |
| page            | Integer | 当前页码                            |
| size            | Integer | 每页条数                            |
- **示例**
## 6.2用户预约教室信息填写
 **接口地址**：/user/submitClassroomApply
- **请求方式**：POST
- **请求参数**：

| 参数名       | 类型         | 是否必填 | 说明       |
| ------------ | ------------ | -------- | ---------- |
| user_account | String       | 是       | 学号       |
| res_id       | String(数组) | 是       | 教室资源id |
| purpose      | String       | 是       | 申请理由   |
| person_count | Integer      | 是       | 参与人数   |


- **返回参数**：

| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |

- **示例**
## 6.3用户预约记录
 **接口地址**：/user/myReservations
- **请求方式**：GET
- **请求参数**：

| 参数名  | 类型    | 是否必填 | 说明     |
| ------- | ------- | -------- | -------- |
| user_id | String  | 是       | 用户id   |
| page    | Integer | 否       | 当前页码 |
| size    | Integer | 否       | 每页条数 |



- **返回参数**：

| 参数名       | 类型    | 说明                                                         |
| ------------ | ------- | ------------------------------------------------------------ |
| week_total   | Integer | 本周我的预约数（用户账号关联的`apply_info`中，`book_time`在本周的记录总数） |
| my_pending   | Integer | 待审核预约数                                                 |
| apply_id     | String  | 申请编号                                                     |
| classroom    | String  | 教室（格式：`building_name+room_num`）                       |
| date         | String  | 使用日期                                                     |
| week         | Integer | 周次                                                         |
| period       | String  | 节次                                                         |
| purpose      | String  | 用途                                                         |
| book_time    | String  | 预约时间（提交申请的时间）                                   |
| apply_status | String  | 审核状态（待审核 / 已通过 / 已驳回）                         |
| can_cancel   | Integer | 是否可取消，0：表示可以取消，1：不可取消，2：已经取消        |
| total        | Integer | 符合条件的预约总数                                           |
| page         | Integer | 当前页码                                                     |
| size         | Integer | 每页条数                                                     |
- **示例**
## 6.4用户确认取消预约
 **接口地址**：/user/cancelReservation
- **请求方式**：POST
- **请求参数**：

| 参数名      | 类型     | 是否必填 | 说明                         |
| -------- | ------ | ---- | -------------------------- |
| apply_id | String | 是    | 申请编号（唯一标识需取消的预约，从预约记录列表获取） |

- **返回参数**：

| 参数名 | 类型      | 说明         |
| --- | ------- | ---------- |
|     | boolean | true/false |

- **示例**

